<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Banking System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .bank-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            border-radius: 15px;
            overflow: hidden;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="bank-header text-center">
        <div class="container">
            <h1 class="display-4 fw-bold">
                <i class="fas fa-university me-3"></i>
                Core Banking System
            </h1>
            <p class="lead">Secure, Reliable, and Efficient Banking Operations</p>
        </div>
    </div>

    <div class="container">
        <!-- Quick Stats -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-users fa-2x text-primary mb-2"></i>
                    <h4 id="customersCount">...</h4>
                    <p class="text-muted">Total Customers</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-wallet fa-2x text-success mb-2"></i>
                    <h4 id="accountsCount">...</h4>
                    <p class="text-muted">Active Accounts</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-exchange-alt fa-2x text-info mb-2"></i>
                    <h4 id="transactionsCount">...</h4>
                    <p class="text-muted">Total Transactions</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-coins fa-2x text-warning mb-2"></i>
                    <h4 id="totalBalance">...</h4>
                    <p class="text-muted">Total Balance</p>
                </div>
            </div>
        </div>

        <!-- Navigation Cards -->
        <div class="row g-4">
            <!-- Customer Management -->
            <div class="col-md-6 col-lg-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Customer Management</h5>
                        <p class="card-text text-muted">Register new customers and manage existing customer information</p>
                        <div class="mt-3">
                            <a href="/add_customer.html" class="btn btn-primary me-2">
                                <i class="fas fa-plus me-1"></i> Add Customer
                            </a>
                            <a href="/view_customers.html" class="btn btn-outline-primary">
                                <i class="fas fa-list me-1"></i> View All
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Management -->
            <div class="col-md-6 col-lg-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-piggy-bank fa-3x text-success mb-3"></i>
                        <h5 class="card-title">Account Management</h5>
                        <p class="card-text text-muted">Open new accounts and manage account status</p>
                        <div class="mt-3">
                            <a href="/open_account.html" class="btn btn-success me-2">
                                <i class="fas fa-plus me-1"></i> Open Account
                            </a>
                            <a href="/view_accounts.html" class="btn btn-outline-success">
                                <i class="fas fa-list me-1"></i> View Accounts
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transactions -->
            <div class="col-md-6 col-lg-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-exchange-alt fa-3x text-info mb-3"></i>
                        <h5 class="card-title">Transactions</h5>
                        <p class="card-text text-muted">Perform deposits, withdrawals, and transfers</p>
                        <div class="mt-3">
                            <div class="btn-group-vertical w-100">
                                <a href="/deposit.html" class="btn btn-info mb-2">
                                    <i class="fas fa-arrow-down me-1"></i> Deposit
                                </a>
                                <a href="/withdraw.html" class="btn btn-warning mb-2">
                                    <i class="fas fa-arrow-up me-1"></i> Withdraw
                                </a>
                                <a href="/transfer.html" class="btn btn-secondary">
                                    <i class="fas fa-random me-1"></i> Transfer
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TCL Demos -->
            <div class="col-md-6 col-lg-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-database fa-3x text-purple mb-3"></i>
                        <h5 class="card-title">TCL Demonstrations</h5>
                        <p class="card-text text-muted">Transaction Control Language examples and tests</p>
                        <div class="mt-3">
                            <a href="/tcl_demo.html" class="btn btn-purple me-2" style="background-color: #6f42c1; color: white;">
                                <i class="fas fa-play me-1"></i> Run Demos
                            </a>
                            <a href="/view_transactions.html" class="btn btn-outline-purple" style="border-color: #6f42c1; color: #6f42c1;">
                                <i class="fas fa-history me-1"></i> Transaction Log
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports & Analytics -->
            <div class="col-md-6 col-lg-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-chart-bar fa-3x text-danger mb-3"></i>
                        <h5 class="card-title">Reports & Analytics</h5>
                        <p class="card-text text-muted">View system reports and banking analytics</p>
                        <div class="mt-3">
                            <a href="/reports.html" class="btn btn-danger me-2">
                                <i class="fas fa-chart-line me-1"></i> View Reports
                            </a>
                            <a href="/audit_log.html" class="btn btn-outline-danger">
                                <i class="fas fa-clipboard-list me-1"></i> Audit Log
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Info -->
            <div class="col-md-6 col-lg-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center p-4">
                        <i class="fas fa-info-circle fa-3x text-dark mb-3"></i>
                        <h5 class="card-title">System Information</h5>
                        <p class="card-text text-muted">Database schema and system documentation</p>
                        <div class="mt-3">
                            <a href="/system_info.html" class="btn btn-dark me-2">
                                <i class="fas fa-info me-1"></i> System Info
                            </a>
                            <button onclick="testConnection()" class="btn btn-outline-dark">
                                <i class="fas fa-bolt me-1"></i> Test Connection
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-history me-2"></i>Recent Transactions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="recentTransactions" class="table-responsive">
                            <p class="text-center text-muted">Loading recent transactions...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2024 Core Banking System. Built with Node.js, Express & MySQL.</p>
            <p class="mb-0">Transaction Control Language (TCL) Demonstrations: COMMIT, ROLLBACK, SAVEPOINT</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                // Load customers count
                const customersRes = await fetch('/api/customers');
                const customers = await customersRes.json();
                document.getElementById('customersCount').textContent = customers.length;

                // Load accounts count and total balance
                const accountsRes = await fetch('/api/accounts');
                const accounts = await accountsRes.json();
                const activeAccounts = accounts.filter(acc => acc.status === 'active');
                document.getElementById('accountsCount').textContent = activeAccounts.length;
                
                const totalBalance = activeAccounts.reduce((sum, acc) => sum + parseFloat(acc.balance), 0);
                document.getElementById('totalBalance').textContent = '$' + totalBalance.toLocaleString('en-US', {minimumFractionDigits: 2});

                // Load transactions count
                const transactionsRes = await fetch('/api/transactions/list?limit=1000');
                const transactions = await transactionsRes.json();
                document.getElementById('transactionsCount').textContent = transactions.length;

                // Load recent transactions
                loadRecentTransactions();

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                document.getElementById('customersCount').textContent = 'Error';
                document.getElementById('accountsCount').textContent = 'Error';
                document.getElementById('transactionsCount').textContent = 'Error';
                document.getElementById('totalBalance').textContent = 'Error';
            }
        }

        // Load recent transactions
        async function loadRecentTransactions() {
            try {
                const res = await fetch('/api/transactions/list?limit=5');
                const transactions = await res.json();
                
                const tableHtml = `
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${transactions.map(txn => `
                                <tr>
                                    <td>${new Date(txn.created_at).toLocaleString()}</td>
                                    <td>
                                        <span class="badge ${
                                            txn.type === 'deposit' ? 'bg-success' : 
                                            txn.type === 'withdrawal' ? 'bg-warning' : 'bg-info'
                                        }">
                                            ${txn.type.toUpperCase()}
                                        </span>
                                    </td>
                                    <td>${txn.description || 'Transaction'}</td>
                                    <td class="fw-bold ${
                                        txn.type === 'deposit' ? 'text-success' : 
                                        txn.type === 'withdrawal' ? 'text-danger' : 'text-info'
                                    }">
                                        ${txn.type === 'withdrawal' ? '-' : ''}$${parseFloat(txn.amount).toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                document.getElementById('recentTransactions').innerHTML = tableHtml;
            } catch (error) {
                document.getElementById('recentTransactions').innerHTML = 
                    '<p class="text-center text-danger">Error loading recent transactions</p>';
            }
        }

        // Test database connection
        async function testConnection() {
            try {
                const res = await fetch('/health');
                const data = await res.json();
                alert('✅ System is running properly!\n' + 
                      `Status: ${data.status}\n` +
                      `Service: ${data.service}\n` +
                      `Database: ${data.database}\n` +
                      `Timestamp: ${new Date(data.timestamp).toLocaleString()}`);
            } catch (error) {
                alert('❌ Connection test failed: ' + error.message);
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', loadDashboardStats);
    </script>
</body>
</html>